# WGCNA Analysis Report: Gene Co-expression in Brachypodium

## 1. Methodology
To construct the gene co-expression network, **WGCNA** package in R had been used. The analysis was performed on RNAseq data from watered (W) samples of *Brachypodium distachyon*. 
* **Preprocessing:** Data was cleaned and filtered for high-quality expression.
* **Network Construction:** A weighted adjacency matrix was built using a soft-thresholding power.
* **Module Definition:** Clusters were identified using the Dynamic Tree Cut algorithm based on Topological Overlap (TOM).
* **Merging:** Similar modules were merged based on a correlation threshold of 0.75 (cut height 0.25).

---

## 2. Main Inputs and Outputs
| Step | Input | Output |
| :--- | :--- | :--- |
| **Expression Data** | `TPM_counts_Drought_W_dataset.csv` | Cleaned Matrix (9,940 genes) |
| **Outlier Analysis** | Transposed Matrix | `sampleClustering.pdf` |
| **Scaling** | Filtered Data | Scale-free Topology Fit Plots |
| **Module Analysis** | TOM Matrix | `net_W.RData` / Dendrograms |
| **Traits** | `TRAITS_W.csv` | `Module-trait Heatmap` |

---

## 3. Exercise Solutions (Results)

**3.1) Samples & Isoforms:**
The dataset `TPM_counts_Drought_W_dataset.csv` included **26 samples** and **9,940 genes** (isoforms) after initial filtering steps.

**3.2) Outliers:**
**0 samples** were discarded. After performing the outlier analysis, all samples clustered below the defined height threshold of $2.5 \times 10^5$.

**3.3) Power Value:**
A soft-thresholding power value of **6** was set as appropriate, as it was the lowest power reaching a Scale-Free Topology Fit ($R^2$) above 0.80 (specifically 0.879).
![Scale-free Topology Power Selection](power_plots.png)

**3.4) Module Merging:**
Initially, **35+ modules** were established. After the merging process (using a cut height of 0.25), the modules were refined into a final set of consolidated color-coded groups.
![Gene Dendrogram and Modules](merged_modules.png)

**3.5) Cyan Module Hub:**
According to the module membership data, the hub isoform for the **cyan** module is **Bradi1g00700.3**.

**3.6) Trait Correlation:**
According to the module-trait association heat map, the **Violet module** has the highest positive correlation (**0.66**, $p=3 \times 10^{-4}$) with the **"blwgrd"** (below ground biomass) trait.
![Module-Trait Relationship Heatmap](heatmap.png)
---

## 4. Problems Encountered

1. Missing R Dependencies:
   * Problem: The 'WGCNA' package failed to load because 'preprocessCore' and 'impute' 
     libraries were missing in the Docker container.
   * Solution: Installed the required Bioconductor packages manually:
     > BiocManager::install(c("preprocessCore", "impute"), configure.args="--disable-threading")

2. Plot Rendering & GitHub Visibility:
   * Problem: The script generated plots in .pdf format, which does not display 
     automatically in GitHub Markdown reports.
   * Solution: I modified the R script to use 'png()' device drivers to save the 
     Module-Trait Heatmap and Dendrograms as .png files for direct integration.

3. Memory Constraints during Matrix Calculation:
   * Problem: The 'blockwiseModules' function crashed the R session when processing 
     9,940 isoforms due to RAM limits in the container.
   * Solution: I optimized the 'maxBlockSize' parameter to 12,000 and monitored 
     resource usage using 'docker stats' to prevent memory overflow.

4. Case-Sensitivity & 404 Errors:
   * Problem: Differences between folder names (e.g., 'Transcripts' vs 'transcripts') 
     caused broken links in the main README.
   * Solution: Standardized all folder and file naming conventions to lowercase 
     and updated relative paths to ensure seamless navigation.
--

1. WGCNA Official Documentation:
   * Langfelder P, Horvath S (2008). "WGCNA: an R package for weighted 
     correlation network analysis." BMC Bioinformatics.
   * URL: https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/

2. Course Materials (Zaragoza 2025):
   * Session 3: Co-expression Network Analysis (WGCNA) Practical Guide.
   * Dataset: TPM_counts_Drought_W_dataset.csv (Wheat Transcriptome).

3. Software & Tools:
   * R version 4.x (via Docker Container)
   * Bioconductor (preprocessCore, GO.db, AnnotationDbi)
   * GitHub for Project Version Control and Reporting

4. Biological Context:
   * GET_HOMOLOGUES-EST protocol for wheat pangenome and 
     transcriptome comparisons.

